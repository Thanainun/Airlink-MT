(function(e){var c={init:function(a){if(!this.data("jqv")||this.data("jqv")==null)c._saveOptions(this,a),e(".formError").live("click",function(){e(this).fadeOut(150,function(){e(this).remove()})})},attach:function(a){a=a?c._saveOptions(this,a):this.data("jqv");if(!a.binded)a.bindMethod=="bind"?(this.find("[class*=validate]:not([type=checkbox])").bind(a.validationEventTrigger,c._onFieldEvent),this.find("[class*=validate][type=checkbox]").bind("click",c._onFieldEvent),this.bind("submit",c._onSubmitEvent)):
a.bindMethod=="live"&&(this.find("[class*=validate]:not([type=checkbox])").live(a.validationEventTrigger,c._onFieldEvent),this.find("[class*=validate][type=checkbox]").live("click",c._onFieldEvent),this.live("submit",c._onSubmitEvent)),a.binded=!0},detach:function(){var a=this.data("jqv");a.binded&&(this.find("[class*=validate]").not("[type=checkbox]").unbind(a.validationEventTrigger,c._onFieldEvent),this.find("[class*=validate][type=checkbox]").unbind("click",c._onFieldEvent),this.unbind("submit",
c.onAjaxFormComplete),this.find("[class*=validate]").not("[type=checkbox]").die(a.validationEventTrigger,c._onFieldEvent),this.find("[class*=validate][type=checkbox]").die("click",c._onFieldEvent),this.die("submit",c.onAjaxFormComplete),this.removeData("jqv"))},validate:function(){return c._validateFields(this)},validateField:function(a){var b=e(this).data("jqv");return c._validateField(e(a),b)},validateform:function(){return c._onSubmitEvent.call(this)},showPrompt:function(a,b,h,d){var f=this.closest("form").data("jqv");
f||(f=c._saveOptions(this,f));if(h)f.promptPosition=h;f.showArrow=d==!0;c._showPrompt(this,a,b,!1,f)},hidePrompt:function(){var a="."+c._getClassName(e(this).attr("id"))+"formError";e(a).fadeTo("fast",0.3,function(){e(this).remove()})},hide:function(){var a=e(this).is("form")?"parentForm"+e(this).attr("id"):e(this).attr("id")+"formError";e("."+a).fadeTo("fast",0.3,function(){e(this).remove()})},hideAll:function(){e(".formError").fadeTo("fast",0.3,function(){e(this).remove()})},_onFieldEvent:function(){var a=
e(this),b=a.closest("form").data("jqv");c._validateField(a,b)},_onSubmitEvent:function(){var a=e(this),b=a.data("jqv"),h=c._validateFields(a,!0);if(h&&b.ajaxFormValidation)return c._validateFormWithAjax(a,b),!1;if(b.onValidationComplete)return b.onValidationComplete(a,h),!1;return h},_checkAjaxStatus:function(a){var b=!0;e.each(a.ajaxValidCache,function(a,d){if(!d)return b=!1});return b},_validateFields:function(a,b){var h=a.data("jqv"),d=!1;a.trigger("jqv.form.validating");a.find("[class*=validate]").not(":hidden").each(function(){var a=
e(this);d|=c._validateField(a,h,b)});a.trigger("jqv.form.result",[d]);if(d){if(h.scroll){for(var f=Number.MAX_VALUE,g=e(".formError:not('.greenPopup')"),j=0;j<g.length;j++){var l=e(g[j]).offset().top;l<f&&(f=l)}h.isOverflown?(j=e(h.overflownDIV),g=j.scrollTop(),j=-parseInt(j.offset().top),f+=g+j-5,e(h.overflownDIV+":not(:animated)").animate({scrollTop:f},1100)):e("html:not(:animated),body:not(:animated)").animate({scrollTop:f},1100)}return!1}return!0},_validateFormWithAjax:function(a,b){var h=a.serialize(),
d=b.ajaxFormValidationURL?b.ajaxFormValidationURL:a.attr("action");e.ajax({type:"GET",url:d,cache:!1,dataType:"json",data:h,form:a,methods:c,options:b,beforeSend:function(){return b.onBeforeAjaxFormValidation(a,b)},error:function(a,b){c._ajaxError(a,b)},success:function(d){if(d!==!0){for(var h=!1,j=0;j<d.length;j++){var l=d[j],k=e(e("#"+l[0])[0]);if(k.length==1){var i=l[2];if(l[1]==!0)if(i==""||!i)c._closePrompt(k);else{if(b.allrules[i])(l=b.allrules[i].alertTextOk)&&(i=l);c._showPrompt(k,i,"pass",
!1,b,!0)}else{h|=1;if(b.allrules[i])(l=b.allrules[i].alertText)&&(i=l);c._showPrompt(k,i,"",!1,b,!0)}}}b.onAjaxFormComplete(!h,a,d,b)}else b.onAjaxFormComplete(!0,a,"",b)}})},_validateField:function(a,b,h){a.attr("id")||e.error("jQueryValidate: an ID attribute is required for this field: "+a.attr("name")+" class:"+a.attr("class"));var d=/validate\[(.*)\]/.exec(a.attr("class"));if(!d)return!1;var f=d[1].split(/\[|,|\]/),d=!1,g=a.attr("name"),j="",l=!1;b.isError=!1;b.showArrow=!0;optional=!1;for(var k=
0;k<f.length;k++){var i=void 0;switch(f[k]){case "optional":optional=!0;break;case "required":l=!0;i=c._required(a,f,k,b);break;case "custom":i=c._customRegex(a,f,k,b);break;case "ajax":h||(c._ajax(a,f,k,b),d=!0);break;case "minSize":i=c._minSize(a,f,k,b);break;case "maxSize":i=c._maxSize(a,f,k,b);break;case "min":i=c._min(a,f,k,b);break;case "max":i=c._max(a,f,k,b);break;case "past":i=c._past(a,f,k,b);break;case "future":i=c._future(a,f,k,b);break;case "maxCheckbox":i=c._maxCheckbox(a,f,k,b);a=e(e("input[name='"+
g+"']"));break;case "minCheckbox":i=c._minCheckbox(a,f,k,b);a=e(e("input[name='"+g+"']"));break;case "equals":i=c._equals(a,f,k,b);break;case "funcCall":i=c._funcCall(a,f,k,b)}if(i!==void 0)j+=i+"<br/>",b.isError=!0}if(!l&&a.val()=="")b.isError=!1;h=a.attr("type");if((h=="radio"||h=="checkbox")&&e("input[name='"+g+"']").size()>1)a=e(e("input[name='"+g+"'][type!=hidden]:first")),b.showArrow=!1;b.isError?c._showPrompt(a,j,"",!1,b):d||c._closePrompt(a);a.closest("form").trigger("jqv.field.error",[a,
b.isError,j]);return b.isError},_required:function(a,b,c,d){switch(a.attr("type")){default:if(!a.val())return d.allrules[b[c]].alertText;break;case "radio":case "checkbox":a=a.attr("name");if(e("input[name='"+a+"']:checked").size()==0)return e("input[name='"+a+"']").size()==1?d.allrules[b[c]].alertTextCheckboxe:d.allrules[b[c]].alertTextCheckboxMultiple;break;case "select-one":if(!a.val())return d.allrules[b[c]].alertText;break;case "select-multiple":if(!a.find("option:selected").val())return d.allrules[b[c]].alertText}},
_customRegex:function(a,b,c,d){b=b[c+1];if(c=d.allrules[b])if(c=c.regex){if(!RegExp(c).test(a.attr("value")))return d.allrules[b].alertText}else alert("jqv:custom regex not found "+b);else alert("jqv:custom rule not found "+b)},_funcCall:function(a,b,c,d){var e=window[b[c+1]];if(typeof e=="function")return e(a,b,c,d)},_equals:function(a,b,c,d){b=b[c+1];if(a.attr("value")!=e("#"+b).attr("value"))return d.allrules.equals.alertText},_maxSize:function(a,b,c,d){b=b[c+1];if(a.attr("value").length>b)return a=
d.allrules.maxSize,a.alertText+b+a.alertText2},_minSize:function(a,b,c,d){b=b[c+1];if(a.attr("value").length<b)return a=d.allrules.minSize,a.alertText+b+a.alertText2},_min:function(a,b,c,d){b=parseFloat(b[c+1]);if(parseFloat(a.attr("value"))<b){a=d.allrules.min;if(a.alertText2)return a.alertText+b+a.alertText2;return a.alertText+b}},_max:function(a,b,c,d){b=parseFloat(b[c+1]);if(parseFloat(a.attr("value"))>b){a=d.allrules.max;if(a.alertText2)return a.alertText+b+a.alertText2;return a.alertText+b}},
_past:function(a,b,e,d){b=b[e+1];b=b.toLowerCase()=="now"?new Date:c._parseDate(b);if(c._parseDate(a.attr("value"))>b){a=d.allrules.past;if(a.alertText2)return a.alertText+c._dateToString(b)+a.alertText2;return a.alertText+c._dateToString(b)}},_future:function(a,b,e,d){b=b[e+1];b=b.toLowerCase()=="now"?new Date:c._parseDate(b);if(c._parseDate(a.attr("value"))<b){a=d.allrules.future;if(a.alertText2)return a.alertText+c._dateToString(b)+a.alertText2;return a.alertText+c._dateToString(b)}},_maxCheckbox:function(a,
b,c,d){b=b[c+1];a=a.attr("name");if(e("input[name='"+a+"']:checked").size()>b)return d.showArrow=!1,d.allrules.maxCheckbox.alertText},_minCheckbox:function(a,b,c,d){b=b[c+1];a=a.attr("name");if(e("input[name='"+a+"']:checked").size()<b)return d.showArrow=!1,d.allrules.minCheckbox.alertText+" "+b+" "+d.allrules.minCheckbox.alertText2},_ajax:function(a,b,h,d){var f=d.allrules[b[h+1]];(b=f.extraData)||(b="");d.isError||e.ajax({type:"GET",url:f.url,cache:!1,dataType:"json",data:"fieldId="+a.attr("id")+
"&fieldValue="+a.attr("value")+"&extraData="+b,field:a,rule:f,methods:c,options:d,beforeSend:function(){var b=f.alertTextLoad;b&&c._showPrompt(a,b,"load",!0,d)},error:function(a,b){c._ajaxError(a,b)},success:function(a){var b=a[0],h=e(e("#"+b)[0]);if(h.length==1)a[1]?(d.ajaxValidCache[b]!==void 0&&(d.ajaxValidCache[b]=!0),(a=f.alertTextOk)?c._showPrompt(h,a,"pass",!0,d):c._closePrompt(h)):(d.ajaxValidCache[b]=!1,d.isError=!0,c._showPrompt(h,f.alertText,"",!0,d))}})},_ajaxError:function(a,b){a.status==
0&&b==null?alert("The page is not served from a server! ajax call failed"):typeof console!="undefined"&&console.log("Ajax error: "+a.status+" "+b)},_dateToString:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},_parseDate:function(a){var b=a.split("-");b!==a&&(b=a.split("/"));return new Date(b[0],b[1]-1,b[2])},_showPrompt:function(a,b,e,d,f,g){var j=c._getPrompt(a);g&&(j=!1);j?c._updatePrompt(a,j,b,e,d,f):c._buildPrompt(a,b,e,d,f)},_buildPrompt:function(a,b,h,d,f){var g=e("<div>");
g.addClass(c._getClassName(a.attr("id"))+"formError");a.is(":input")&&g.addClass("parentForm"+c._getClassName(a.parents("form").attr("id")));g.addClass("formError");switch(h){case "pass":g.addClass("greenPopup");break;case "load":g.addClass("blackPopup")}d&&g.addClass("ajaxed");e("<div>").addClass("formErrorContent").html(b).appendTo(g);if(f.showArrow)switch(b=e("<div>").addClass("formErrorArrow"),f.promptPosition){case "bottomLeft":case "bottomRight":g.find(".formErrorContent").before(b);b.addClass("formErrorArrowBottom").html('<div class="line1"><\!-- --\></div><div class="line2"><\!-- --\></div><div class="line3"><\!-- --\></div><div class="line4"><\!-- --\></div><div class="line5"><\!-- --\></div><div class="line6"><\!-- --\></div><div class="line7"><\!-- --\></div><div class="line8"><\!-- --\></div><div class="line9"><\!-- --\></div><div class="line10"><\!-- --\></div>');
break;case "topLeft":case "topRight":b.html('<div class="line10"><\!-- --\></div><div class="line9"><\!-- --\></div><div class="line8"><\!-- --\></div><div class="line7"><\!-- --\></div><div class="line6"><\!-- --\></div><div class="line5"><\!-- --\></div><div class="line4"><\!-- --\></div><div class="line3"><\!-- --\></div><div class="line2"><\!-- --\></div><div class="line1"><\!-- --\></div>'),g.append(b)}f.isOverflown?a.before(g):e("body").append(g);a=c._calculatePosition(a,g,f);g.css({top:a.callerTopPosition,
left:a.callerleftPosition,marginTop:a.marginTopSize,opacity:0});return g.animate({opacity:0.87})},_updatePrompt:function(a,b,e,d,f,g){b&&(d=="pass"?b.addClass("greenPopup"):b.removeClass("greenPopup"),d=="load"?b.addClass("blackPopup"):b.removeClass("blackPopup"),f?b.addClass("ajaxed"):b.removeClass("ajaxed"),b.find(".formErrorContent").html(e),a=c._calculatePosition(a,b,g),b.animate({top:a.callerTopPosition,marginTop:a.marginTopSize}))},_closePrompt:function(a){var b=c._getPrompt(a);b&&b.fadeTo("fast",
0,function(){b.remove()})},closePrompt:function(a){return c._closePrompt(a)},_getPrompt:function(a){a="."+c._getClassName(a.attr("id"))+"formError";if(a=e(a)[0])return e(a)},_calculatePosition:function(a,b,c){var d,e,g=a.width(),j=b.height(),l=c.isOverflown;l?(b=d=0,e=-j):(d=a.offset(),b=d.top,d=d.left,e=0);switch(c.promptPosition){default:case "topRight":l?d+=g-30:(d+=g-30,b+=-j);break;case "topLeft":b+=-j-10;break;case "centerRight":d+=g+13;break;case "bottomLeft":b=b+a.height()+15;break;case "bottomRight":d+=
g-30,b+=a.height()+5}return{callerTopPosition:b+"px",callerleftPosition:d+"px",marginTopSize:e+"px"}},_saveOptions:function(a,b){if(e.validationEngineLanguage)var c=e.validationEngineLanguage.allRules;else e.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");c=e.extend({validationEventTrigger:"blur",scroll:!0,promptPosition:"topRight",bindMethod:"bind",inlineAjax:!1,ajaxFormValidation:!1,ajaxFormValidationURL:!1,onAjaxFormComplete:e.noop,onBeforeAjaxFormValidation:e.noop,
onValidationComplete:!1,isOverflown:!1,overflownDIV:"",allrules:c,binded:!1,showArrow:!0,isError:!1,ajaxValidCache:{}},b);a.data("jqv",c);return c},_getClassName:function(a){return a.replace(":","_").replace(".","_")}};e.fn.validationEngine=function(a){var b=e(this);if(!b[0])return!1;if(typeof a=="string"&&a.charAt(0)!="_"&&c[a])return a!="showPrompt"&&a!="hidePrompt"&&a!="hide"&&a!="hideAll"&&c.init.apply(b),c[a].apply(b,Array.prototype.slice.call(arguments,1));else if(typeof a=="object"||!a)return c.init.apply(b,
arguments),c.attach.apply(b);else e.error("Method "+a+" does not exist in jQuery.validationEngine")}})(jQuery);